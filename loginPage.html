<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - LinoxFitness</title>
  <link rel="stylesheet" href="HomePage.css" />
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="nav-brand">
        <h1><a href="home.html" style="color: white; text-decoration: none;">LinoxFitness</a></h1>
      </div>
      <ul class="nav-menu">
        <li><a href="about.html">About</a></li>
        <li><a href="schedule.html">Workout Schedule</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="credentials.html">Credentials</a></li>
        <li><a href="signUp.html">Sign Up</a></li>
        <li><a href="loginPage.html">Login</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="hero" style="min-height: 60vh;">
      <div class="hero-content">
        <h1>Welcome Back</h1>
        <p>Log in to access your personalized fitness plans and track your progress.</p>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <div style="max-width: 500px; margin: 0 auto; background: white; padding: 3rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
          <h2 style="text-align: center; margin-bottom: 2rem; color: #1e1e2f;">Login to Your Account</h2>
          
          <!-- Test Account Information -->
          <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem; border-left: 4px solid #667eea;">
            <h4 style="margin: 0 0 1rem 0; color: #0056b3;">üß™ Test Accounts Available</h4>
            <div style="margin-bottom: 1rem;">
              <strong>Admin Account:</strong><br>
              Email: <code>shaunvdbijl@gmail.com</code><br>
              Password: <code>@dm1n313</code><br>
              <small style="color: #1e3a8a; font-weight: bold;">‚Üí Access to Admin Portal</small>
            </div>
            <div>
              <strong>Test Account:</strong><br>
              Email: <code>test@example.com</code><br>
              Password: <code>Test123!</code>
            </div>
            <small style="color: #666; display: block; margin-top: 0.5rem;">Use these existing accounts or <a href="signUp.html" style="color: #667eea; font-weight: bold;">sign up</a> with your own.</small>
          </div>
          
          <form id="loginForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <div>
              <label for="loginEmail" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #333;">Email Address *</label>
              <input type="email" id="loginEmail" name="email" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box;">
            </div>
            
            <div>
              <label for="loginPassword" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #333;">Password *</label>
              <div style="position: relative;">
                <input type="password" id="loginPassword" name="password" required style="width: 100%; padding: 12px; padding-right: 45px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box;">
                <button type="button" id="togglePassword" onclick="togglePasswordVisibility()" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #666; padding: 4px; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s ease;" title="Show password">
                  üëÅÔ∏è
                </button>
              </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 1rem 0;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="rememberMe" name="rememberMe" style="width: auto;">
                <label for="rememberMe" style="font-size: 0.9rem; color: #333;">Remember me</label>
              </div>
              <a href="reset-password.html" style="color: #667eea; font-size: 0.9rem; text-decoration: none;">Forgot Password?</a>
            </div>
            
            <button type="submit" class="btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem; margin-top: 1rem;">Log In</button>
          </form>
          
          <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
            <p style="color: #666;">Don't have an account? <a href="signUp.html" style="color: #667eea; font-weight: bold;">Sign up here</a></p>
          </div>
          
          <div style="text-align: center; margin-top: 2rem;">
            <p style="color: #666; font-size: 0.9rem;">Or continue with</p>
            <div style="display: flex; gap: 1rem; margin-top: 1rem; justify-content: center;">
              <button style="padding: 10px 20px; border: 2px solid #e9ecef; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                <span style="font-weight: bold; color: #333;">Google</span>
              </button>
              <button style="padding: 10px 20px; border: 2px solid #e9ecef; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                <span style="font-weight: bold; color: #333;">Facebook</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="cta">
      <div class="container">
        <h2>Ready to Continue Your Journey?</h2>
        <p>Log in to access your personalized dashboard, workout plans, and progress tracking.</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-top: 2rem;">
          <div style="text-align: center;">
            <h3 style="color: #ffd700; margin-bottom: 1rem;">Your Dashboard</h3>
            <p>Access your personalized fitness dashboard with progress tracking and analytics.</p>
          </div>
          <div style="text-align: center;">
            <h3 style="color: #ffd700; margin-bottom: 1rem;">Workout Plans</h3>
            <p>View and update your customized workout plans designed by our expert trainers.</p>
          </div>
          <div style="text-align: center;">
            <h3 style="color: #ffd700; margin-bottom: 1rem;">Book Sessions</h3>
            <p>Schedule personal training sessions and group classes directly from your account.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>LinoxFitness</h3>
          <p>Transforming lives through personalized fitness and nutrition guidance.</p>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="services.html">Services</a></li>
            <li><a href="schedule.html">Schedule</a></li>
            <li><a href="credentials.html">Credentials</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Contact</h4>
          <p>Ready to start your journey?</p>
          <a href="signUp.html" class="btn-outline">Get Started</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 LinoxFitness. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase CDN -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase configuration - using your actual config
    const firebaseConfig = {
      apiKey: "AIzaSyCIrzE92nfyWeCxqpX1KcR2c_Rs1ubviy4",
      authDomain: "linox-soccer.firebaseapp.com",
      projectId: "linox-soccer",
      storageBucket: "linox-soccer.firebasestorage.app",
      messagingSenderId: "313058607377",
      appId: "1:313058607377:web:784530fe05a04272dd4cb0",
      measurementId: "G-QQJD06D5RK"
    };
    
    console.log('‚úÖ Using Firebase configuration for linox-soccer project');

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Login functionality
    class LoginPageFirebase {
      constructor() {
        this.init();
      }

      async init() {
        await this.checkExistingSession();
        this.setupEventListeners();
      }

      async checkExistingSession() {
        return new Promise((resolve) => {
          onAuthStateChanged(auth, async (user) => {
            if (user) {
              try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                  const userData = userDoc.data();
                  
                  if (userData.isAdmin) {
                    window.location.href = 'admin-portal.html';
                  } else {
                    window.location.href = 'dashboard.html';
                  }
                } else {
                  window.location.href = 'dashboard.html';
                }
              } catch (error) {
                console.error('Error checking user profile:', error);
                window.location.href = 'dashboard.html';
              }
            }
            resolve();
          });
        });
      }

      setupEventListeners() {
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleLogin();
          });
        }
      }

      async handleLogin() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const submitButton = document.querySelector('#loginForm button[type="submit"]');

        // Clear any existing notifications
        this.clearNotifications();

        // Validate fields
        if (!email || !password) {
          this.showNotification('Please fill in all fields', 'error');
          return;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          this.showNotification('Please enter a valid email address', 'error');
          return;
        }

        // Show loading state
        const originalText = submitButton.textContent;
        submitButton.textContent = 'Logging in...';
        submitButton.disabled = true;

        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;
          
          // Get user profile from Firestore
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            
            // Check if account is active
            if (userData.isActive === false) {
              await auth.signOut();
              this.showNotification('Your account has been deactivated. Please contact support.', 'error');
              submitButton.textContent = originalText;
              submitButton.disabled = false;
              return;
            }
            
            if (userData.isAdmin) {
              this.showNotification('Welcome back, Admin! Redirecting to admin portal...', 'success');
              setTimeout(() => {
                window.location.href = 'admin-portal.html';
              }, 1500);
            } else {
              this.showNotification(`Welcome back, ${userData.firstName || 'User'}! Redirecting to dashboard...`, 'success');
              setTimeout(() => {
                window.location.href = 'dashboard.html';
              }, 1500);
            }
          } else {
            this.showNotification('Welcome back! Redirecting to dashboard...', 'success');
            setTimeout(() => {
              window.location.href = 'dashboard.html';
            }, 1500);
          }
        } catch (error) {
          console.error('Login error:', error);
          let errorMessage = 'Login failed. Please try again.';
          
          // Handle specific Firebase authentication errors
          switch (error.code) {
            case 'auth/user-not-found':
              errorMessage = '‚ùå Email not found. Please check your email or <a href="signUp.html" style="color: #667eea; font-weight: bold;">sign up for an account</a>.';
              break;
            case 'auth/wrong-password':
              errorMessage = '‚ùå Incorrect password. Please try again or use "Forgot Password".';
              break;
            case 'auth/invalid-email':
              errorMessage = '‚ùå Invalid email format. Please enter a valid email address.';
              break;
            case 'auth/user-disabled':
              errorMessage = '‚ùå This account has been disabled. Please contact support.';
              break;
            case 'auth/too-many-requests':
              errorMessage = '‚ùå Too many failed login attempts. Your account has been temporarily locked. Please try again later or reset your password.';
              break;
            case 'auth/network-request-failed':
              errorMessage = '‚ùå Network error. Please check your internet connection and try again.';
              break;
            case 'auth/invalid-credential':
            case 'auth/invalid-login-credentials':
              errorMessage = '‚ùå Invalid email or password. Please check your credentials and try again. If you don\'t have an account, <a href="signUp.html" style="color: #667eea; font-weight: bold;">sign up here</a>.';
              break;
            case 'auth/operation-not-allowed':
              errorMessage = '‚ùå Email/password sign-in is not enabled. Please contact support.';
              break;
            case 'auth/weak-password':
              errorMessage = '‚ùå Password is too weak. Please use a stronger password.';
              break;
            default:
              errorMessage = `‚ùå Login failed: ${error.message}. Please verify your credentials or <a href="signUp.html" style="color: #667eea; font-weight: bold;">create an account</a>.`;
          }
          
          this.showNotification(errorMessage, 'error');
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      }

      showNotification(message, type = 'info') {
        // Remove any existing notifications
        this.clearNotifications();

        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          max-width: 400px;
          padding: 1.25rem 1.5rem;
          border-radius: 10px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out;
          font-size: 1rem;
          line-height: 1.5;
          ${type === 'error' ? 'background: #fee; color: #c33; border-left: 4px solid #c33;' : ''}
          ${type === 'success' ? 'background: #d4edda; color: #155724; border-left: 4px solid #28a745;' : ''}
          ${type === 'warning' ? 'background: #fff3cd; color: #856404; border-left: 4px solid #ffc107;' : ''}
          ${type === 'info' ? 'background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8;' : ''}
        `;

        const icon = document.createElement('span');
        icon.style.cssText = 'font-size: 1.2rem; margin-right: 0.75rem; font-weight: bold;';
        if (type === 'error') icon.textContent = '‚ö†Ô∏è';
        else if (type === 'success') icon.textContent = '‚úÖ';
        else if (type === 'warning') icon.textContent = '‚ö†Ô∏è';
        else icon.textContent = '‚ÑπÔ∏è';

        const messageSpan = document.createElement('span');
        messageSpan.innerHTML = message;

        const closeButton = document.createElement('button');
        closeButton.innerHTML = '√ó';
        closeButton.style.cssText = `
          position: absolute;
          top: 10px;
          right: 10px;
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: inherit;
          opacity: 0.7;
          transition: opacity 0.2s;
          padding: 0;
          width: 24px;
          height: 24px;
          line-height: 1;
        `;
        closeButton.onmouseover = () => closeButton.style.opacity = '1';
        closeButton.onmouseout = () => closeButton.style.opacity = '0.7';
        closeButton.onclick = () => notification.remove();

        notification.appendChild(icon);
        notification.appendChild(messageSpan);
        notification.appendChild(closeButton);
        document.body.appendChild(notification);

        // Auto-remove after 6 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.animation = 'slideOutRight 0.3s ease-out';
            setTimeout(() => notification.remove(), 300);
          }
        }, 6000);
      }

      clearNotifications() {
        const notifications = document.querySelectorAll('.notification');
        notifications.forEach(notif => notif.remove());
      }
    }

    // Initialize login page when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new LoginPageFirebase();
    });

    // Password toggle function - exposed to global scope
    window.togglePasswordVisibility = function() {
      const passwordInput = document.getElementById('loginPassword');
      const toggleButton = document.getElementById('togglePassword');
      
      if (passwordInput && toggleButton) {
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleButton.textContent = 'üôà';
          toggleButton.title = 'Hide password';
          toggleButton.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
        } else {
          passwordInput.type = 'password';
          toggleButton.textContent = 'üëÅÔ∏è';
          toggleButton.title = 'Show password';
          toggleButton.style.backgroundColor = 'transparent';
        }
      }
    };

    // Add notification animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      
      .notification {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      #togglePassword:hover {
        background-color: rgba(102, 126, 234, 0.1) !important;
        color: #667eea !important;
      }
      
      #togglePassword:active {
        transform: translateY(-50%) scale(0.95) !important;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
