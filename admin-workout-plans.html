<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Plans Management - LINQXFITNESS Admin</title>
    <link rel="stylesheet" href="HomePage.css">
    <style>
        .admin-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
        }

        .admin-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-header h1 {
            color: white;
            margin: 0;
            font-size: 2rem;
            text-align: center;
        }

        .admin-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .admin-nav button, .admin-nav a {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .admin-nav button:hover, .admin-nav a:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #1e3a8a;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            width: 100%;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
            max-width: 100%;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .exercises-section {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
        }

        .exercises-section h3 {
            color: #1e3a8a;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .exercise-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .exercise-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exercise-number {
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .btn-remove-exercise {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-remove-exercise:hover {
            background: #c82333;
        }

        .exercise-fields {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            box-sizing: border-box;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-add {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            box-sizing: border-box;
        }

        .btn-add:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            box-sizing: border-box;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .plan-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .plan-card {
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .plan-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .plan-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .plan-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1e3a8a;
            margin: 0;
        }

        .plan-meta {
            font-size: 0.9rem;
            color: #6c757d;
            margin: 10px 0;
        }

        .plan-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .assign-section {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .assign-section h4 {
            margin-top: 0;
            color: #856404;
        }

        .client-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .client-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .client-item:hover {
            border-color: #3b82f6;
        }

        .client-info {
            flex: 1;
        }

        .client-name {
            font-weight: bold;
            color: #1e3a8a;
        }

        .client-email {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 1.25rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
        }

        .notification.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 968px) {
            .form-grid, .exercise-fields {
                grid-template-columns: 1fr;
            }
            .plan-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>üí™ Workout Plans Management</h1>
            <div class="admin-nav">
                <a href="admin-portal.html">‚Üê Back to Admin Portal</a>
                <a href="admin-schedule.html">üìÖ Class Schedule</a>
                <button onclick="window.location.reload()">üîÑ Refresh</button>
                <button onclick="logout()">üö™ Logout</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('create')">‚ûï Create Plan</button>
            <button class="tab" onclick="switchTab('manage')">üìã Manage Plans</button>
            <button class="tab" onclick="switchTab('assign')">üë• Assign to Clients</button>
        </div>

        <!-- Create Plan Tab -->
        <div id="createTab" class="tab-content active">
            <div class="content-card">
                <h2>Create New Workout Plan</h2>
                <form id="workoutPlanForm">
                    <input type="hidden" id="planId">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="planName">Plan Name *</label>
                            <input type="text" id="planName" placeholder="e.g., Week 1 Strength Training" required>
                        </div>

                        <div class="form-group">
                            <label for="duration">Duration (weeks) *</label>
                            <input type="number" id="duration" min="1" max="52" value="4" required>
                        </div>

                        <div class="form-group full-width">
                            <label for="description">Description</label>
                            <textarea id="description" placeholder="Brief description of the workout plan..."></textarea>
                        </div>
                    </div>

                    <div class="exercises-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Exercises</h3>
                            <button type="button" class="btn-add" onclick="addExercise()">+ Add Exercise</button>
                        </div>
                        
                        <div id="exercisesList">
                            <!-- Exercises will be added here dynamically -->
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn-primary" style="flex: 1;" id="submitBtn">üíæ Save Workout Plan</button>
                        <button type="button" class="btn-secondary" onclick="resetForm()">üîÑ Reset</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Plans Tab -->
        <div id="manageTab" class="tab-content">
            <div class="content-card">
                <h2>All Workout Plans</h2>
                <div id="plansList" class="plan-list">
                    <div class="empty-state">Loading plans...</div>
                </div>
            </div>
        </div>

        <!-- Assign Tab -->
        <div id="assignTab" class="tab-content">
            <div class="content-card">
                <h2>Assign Plans to Clients</h2>
                
                <div class="form-group">
                    <label for="selectPlanToAssign">Select Workout Plan *</label>
                    <select id="selectPlanToAssign" onchange="loadClientsForAssignment()">
                        <option value="">-- Select a plan --</option>
                    </select>
                </div>

                <div id="clientsListForAssignment" class="client-list" style="display: none;">
                    <!-- Clients will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, getDoc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCIrzE92nfyWeCxqpX1KcR2c_Rs1ubviy4",
            authDomain: "linox-soccer.firebaseapp.com",
            projectId: "linox-soccer",
            storageBucket: "linox-soccer.firebasestorage.app",
            messagingSenderId: "313058607377",
            appId: "1:313058607377:web:784530fe05a04272dd4cb0",
            measurementId: "G-QQJD06D5RK"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let exerciseCounter = 0;
        let allPlans = [];
        let allClients = [];

        // Auth check
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                alert('Access denied. Please log in.');
                window.location.href = 'loginPage.html';
                return;
            }
            currentUser = user;
            console.log('‚úÖ Admin authenticated:', user.email);
            
            await loadPlans();
            await loadClients();
            addExercise(); // Add first exercise field
        });

        // Tab switching
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'manage') loadPlans();
            if (tabName === 'assign') populatePlanDropdown();
        };

        // Add exercise field
        window.addExercise = function() {
            exerciseCounter++;
            const exercisesList = document.getElementById('exercisesList');
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-item';
            exerciseDiv.id = `exercise-${exerciseCounter}`;
            exerciseDiv.innerHTML = `
                <div class="exercise-item-header">
                    <div class="exercise-number">${exerciseCounter}</div>
                    <button type="button" class="btn-remove-exercise" onclick="removeExercise(${exerciseCounter})">Remove</button>
                </div>
                <div class="exercise-fields">
                    <div class="form-group">
                        <label>Exercise Name *</label>
                        <input type="text" class="exercise-name" placeholder="e.g., Bench Press" required>
                    </div>
                    <div class="form-group">
                        <label>Sets *</label>
                        <input type="number" class="exercise-sets" min="1" value="3" required>
                    </div>
                    <div class="form-group">
                        <label>Reps *</label>
                        <input type="number" class="exercise-reps" min="1" value="10" required>
                    </div>
                    <div class="form-group">
                        <label>Rest (sec)</label>
                        <input type="number" class="exercise-rest" min="0" value="60">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 10px;">
                    <label>Notes</label>
                    <input type="text" class="exercise-notes" placeholder="Focus on form, tempo, etc.">
                </div>
            `;
            exercisesList.appendChild(exerciseDiv);
        };

        // Remove exercise
        window.removeExercise = function(id) {
            const element = document.getElementById(`exercise-${id}`);
            if (element) {
                element.remove();
                renumberExercises();
            }
        };

        // Renumber exercises
        function renumberExercises() {
            const exercises = document.querySelectorAll('.exercise-item');
            exercises.forEach((ex, index) => {
                const number = ex.querySelector('.exercise-number');
                if (number) number.textContent = index + 1;
            });
        }

        // Submit form
        document.getElementById('workoutPlanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                const exercises = [];
                document.querySelectorAll('.exercise-item').forEach((item, index) => {
                    const name = item.querySelector('.exercise-name').value;
                    const sets = parseInt(item.querySelector('.exercise-sets').value);
                    const reps = parseInt(item.querySelector('.exercise-reps').value);
                    const rest = parseInt(item.querySelector('.exercise-rest').value) || 60;
                    const notes = item.querySelector('.exercise-notes').value;
                    
                    if (name && sets && reps) {
                        exercises.push({
                            order: index + 1,
                            name,
                            sets,
                            reps,
                            rest,
                            notes
                        });
                    }
                });
                
                if (exercises.length === 0) {
                    throw new Error('Please add at least one exercise');
                }
                
                const planData = {
                    planName: document.getElementById('planName').value,
                    duration: parseInt(document.getElementById('duration').value),
                    description: document.getElementById('description').value,
                    exercises,
                    createdBy: currentUser.uid,
                    updatedAt: new Date()
                };
                
                const planId = document.getElementById('planId').value;
                if (planId) {
                    await updateDoc(doc(db, 'workoutPlans', planId), planData);
                    showNotification('‚úÖ Workout plan updated!', 'success');
                } else {
                    planData.createdAt = new Date();
                    planData.assignedTo = [];
                    await addDoc(collection(db, 'workoutPlans'), planData);
                    showNotification('‚úÖ Workout plan created!', 'success');
                }
                
                resetForm();
                await loadPlans();
                
            } catch (error) {
                console.error('‚ùå Error saving plan:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });

        // Reset form
        window.resetForm = function() {
            document.getElementById('workoutPlanForm').reset();
            document.getElementById('planId').value = '';
            document.getElementById('exercisesList').innerHTML = '';
            exerciseCounter = 0;
            addExercise();
            document.getElementById('submitBtn').textContent = 'üíæ Save Workout Plan';
        };

        // Load plans
        async function loadPlans() {
            const plansList = document.getElementById('plansList');
            try {
                const snapshot = await getDocs(collection(db, 'workoutPlans'));
                allPlans = [];
                
                if (snapshot.empty) {
                    plansList.innerHTML = '<div class="empty-state"><h3>üì≠ No Plans Yet</h3><p>Create your first workout plan!</p></div>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const plan = doc.data();
                    allPlans.push({ id: doc.id, ...plan });
                    const assignedCount = plan.assignedTo ? plan.assignedTo.length : 0;
                    
                    html += `
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <h3 class="plan-title">${plan.planName}</h3>
                            </div>
                            <div class="plan-meta">
                                ‚è±Ô∏è ${plan.duration} weeks<br>
                                üí™ ${plan.exercises.length} exercises<br>
                                üë• Assigned to ${assignedCount} client(s)<br>
                                ${plan.description ? `üìù ${plan.description}` : ''}
                            </div>
                            <div class="plan-actions">
                                <button class="btn-secondary" onclick="editPlan('${doc.id}')">‚úèÔ∏è Edit</button>
                                <button class="btn-secondary" onclick="viewPlan('${doc.id}')">üëÅÔ∏è View</button>
                                <button class="btn-danger" onclick="deletePlan('${doc.id}', '${plan.planName}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    `;
                });
                
                plansList.innerHTML = html;
            } catch (error) {
                console.error('‚ùå Error loading plans:', error);
                plansList.innerHTML = '<div class="empty-state"><h3>‚ùå Error</h3><p>' + error.message + '</p></div>';
            }
        }

        // Load clients
        async function loadClients() {
            try {
                const snapshot = await getDocs(collection(db, 'users'));
                allClients = [];
                snapshot.forEach(doc => {
                    const user = doc.data();
                    if (!user.isAdmin) {
                        allClients.push({ id: doc.id, ...user });
                    }
                });
                console.log(`‚úÖ Loaded ${allClients.length} clients`);
            } catch (error) {
                console.error('‚ùå Error loading clients:', error);
            }
        }

        // View plan
        window.viewPlan = function(planId) {
            const plan = allPlans.find(p => p.id === planId);
            if (!plan) return;
            
            let exercisesHtml = '';
            plan.exercises.forEach((ex, i) => {
                exercisesHtml += `${i + 1}. ${ex.name} - ${ex.sets}x${ex.reps} (${ex.rest}s rest)\n   ${ex.notes || ''}\n\n`;
            });
            
            alert(`üìã ${plan.planName}\n\n‚è±Ô∏è Duration: ${plan.duration} weeks\nüìù ${plan.description}\n\nüí™ EXERCISES:\n\n${exercisesHtml}`);
        };

        // Edit plan
        window.editPlan = function(planId) {
            const plan = allPlans.find(p => p.id === planId);
            if (!plan) return;
            
            document.getElementById('planId').value = planId;
            document.getElementById('planName').value = plan.planName;
            document.getElementById('duration').value = plan.duration;
            document.getElementById('description').value = plan.description || '';
            
            document.getElementById('exercisesList').innerHTML = '';
            exerciseCounter = 0;
            
            plan.exercises.forEach(ex => {
                addExercise();
                const lastExercise = document.querySelector('.exercise-item:last-child');
                lastExercise.querySelector('.exercise-name').value = ex.name;
                lastExercise.querySelector('.exercise-sets').value = ex.sets;
                lastExercise.querySelector('.exercise-reps').value = ex.reps;
                lastExercise.querySelector('.exercise-rest').value = ex.rest;
                lastExercise.querySelector('.exercise-notes').value = ex.notes || '';
            });
            
            document.getElementById('submitBtn').textContent = 'üíæ Update Workout Plan';
            switchTab('create');
        };

        // Delete plan
        window.deletePlan = async function(planId, planName) {
            if (!confirm(`Delete "${planName}"?\n\nThis will unassign it from all clients. This cannot be undone.`)) {
                return;
            }
            
            try {
                await deleteDoc(doc(db, 'workoutPlans', planId));
                showNotification('‚úÖ Plan deleted!', 'success');
                await loadPlans();
            } catch (error) {
                console.error('‚ùå Error deleting plan:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
            }
        };

        // Populate plan dropdown
        function populatePlanDropdown() {
            const select = document.getElementById('selectPlanToAssign');
            select.innerHTML = '<option value="">-- Select a plan --</option>';
            allPlans.forEach(plan => {
                select.innerHTML += `<option value="${plan.id}">${plan.planName}</option>`;
            });
        }

        // Load clients for assignment
        window.loadClientsForAssignment = async function() {
            const planId = document.getElementById('selectPlanToAssign').value;
            const clientsList = document.getElementById('clientsListForAssignment');
            
            if (!planId) {
                clientsList.style.display = 'none';
                return;
            }
            
            const plan = allPlans.find(p => p.id === planId);
            if (!plan) return;
            
            clientsList.style.display = 'block';
            let html = '<h3>Select Clients to Assign:</h3>';
            
            allClients.forEach(client => {
                const isAssigned = plan.assignedTo && plan.assignedTo.includes(client.id);
                html += `
                    <div class="client-item">
                        <div class="client-info">
                            <div class="client-name">${client.firstName} ${client.lastName}</div>
                            <div class="client-email">${client.email}</div>
                        </div>
                        ${isAssigned 
                            ? `<button class="btn-danger" onclick="unassignPlan('${planId}', '${client.id}')">Unassign</button>`
                            : `<button class="btn-primary" onclick="assignPlan('${planId}', '${client.id}')">Assign</button>`
                        }
                    </div>
                `;
            });
            
            clientsList.innerHTML = html;
        };

        // Assign plan
        window.assignPlan = async function(planId, clientId) {
            try {
                const planRef = doc(db, 'workoutPlans', planId);
                const planDoc = await getDoc(planRef);
                const plan = planDoc.data();
                
                const assignedTo = plan.assignedTo || [];
                if (!assignedTo.includes(clientId)) {
                    assignedTo.push(clientId);
                    await updateDoc(planRef, { assignedTo });
                }
                
                showNotification('‚úÖ Plan assigned to client!', 'success');
                await loadPlans();
                loadClientsForAssignment();
            } catch (error) {
                console.error('‚ùå Error assigning plan:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
            }
        };

        // Unassign plan
        window.unassignPlan = async function(planId, clientId) {
            try {
                const planRef = doc(db, 'workoutPlans', planId);
                const planDoc = await getDoc(planRef);
                const plan = planDoc.data();
                
                const assignedTo = plan.assignedTo || [];
                const index = assignedTo.indexOf(clientId);
                if (index > -1) {
                    assignedTo.splice(index, 1);
                    await updateDoc(planRef, { assignedTo });
                }
                
                showNotification('‚úÖ Plan unassigned from client!', 'success');
                await loadPlans();
                loadClientsForAssignment();
            } catch (error) {
                console.error('‚ùå Error unassigning plan:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
            }
        };

        // Logout
        window.logout = async function() {
            try {
                await signOut(auth);
                window.location.href = 'loginPage.html';
            } catch (error) {
                console.error('‚ùå Logout error:', error);
                alert('Error logging out');
            }
        };

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>

